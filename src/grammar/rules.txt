PROGRAMME : DIRECTIVE_PRAGMA* DEFINITION_CONTRAT EOF_TOKEN;

DIRECTIVE_PRAGMA : PRAGMA_TOKEN CASHSCRIPT_TOKEN VALEUR_PRAGMA POINT_VIRGULE_TOKEN;

VALEUR_PRAGMA : CONTRAINTE_VERSION [CONTRAINTE_VERSION | eps];

CONTRAINTE_VERSION : [OPERATEUR_VERSION | eps] VERSION_LITTERALE_TOKEN;

OPERATEUR_VERSION : OPERATEUR_BINAIRE_XOR_TOKEN | OPERATEUR_BINAIRE_NON_TOKEN | OPERATEUR_SUPEG_TOKEN | OPERATEUR_SUP_TOKEN | OPERATEUR_INF_TOKEN | OPERATEUR_INFEG_TOKEN | OPERATEUR_EG_TOKEN;

DEFINITION_CONTRAT : CONTRAT_TOKEN IDENTIFIANT_TOKEN LISTE_PARAMETRE ACCOLADE_O_TOKEN {DEFINITION_FONCTION} ACCOLADE_F_TOKEN;

DEFINITION_FONCTION : FONCTION_TOKEN IDENTIFIANT_TOKEN LISTE_PARAMETRE ACCOLADE_O_TOKEN {DECLARATION} ACCOLADE_F_TOKEN;

LISTE_PARAMETRE : PARENTHESE_O_TOKEN [(PARAMETRE (VIRGULE_TOKEN PARAMETRE)* [VIRGULE_TOKEN | eps])| eps] PARENTHESE_F_TOKEN;

PARAMETRE : NOM_TYPE IDENTIFIANT_TOKEN;

BLOC : ACCOLADE_O_TOKEN DECLARATION* ACCOLADE_F_TOKEN | DECLARATION;

DECLARATION : DEFINITION_VARIABLE| AFFECTATION| TEMPS_DECLARATION| requireStatement| SI | WHILE | ECRIRE | LIRE;

DEFINITION_VARIABLE : NOM_TYPE IDENTIFIANT_TOKEN OPERATEUR_EG_TOKEN EXPRESSION POINT_VIRGULE_TOKEN;

AFFECTATION : IDENTIFIANT_TOKEN OPERATEUR_EG_TOKEN EXPRESSION POINT_VIRGULE_TOKEN;

TEMPS_DECLARATION : REQUIRE_TIME_TOKEN PARENTHESE_O_TOKEN TX_VAR_TOKEN OPERATEUR_SUPEG_TOKEN EXPRESSION PARENTHESE_F_TOKEN POINT_VIRGULE_TOKEN;

requireStatement : REQUIRE_TOKEN PARENTHESE_O_TOKEN EXPRESSION PARENTHESE_F_TOKEN POINT_VIRGULE_TOKEN;

SI : SI_TOKEN PARENTHESE_O_TOKEN EXPRESSION PARENTHESE_F_TOKEN BLOC [(SINON_TOKEN BLOC)| eps];

FONCTION : IDENTIFIANT_TOKEN  

LISTE_EXPRESSIONS : PARENTHESE_O_TOKEN [(EXPRESSION (VIRGULE_TOKEN EXPRESSION)* [VIRGULE_TOKEN| eps])| eps] PARENTHESE_F_TOKEN;

EXPRESSION : PARENTHESE_O_TOKEN EXPRESSION PARENTHESE_F_TOKEN 
    | NOM_TYPE PARENTHESE_O_TOKEN EXPRESSION [(VIRGULE_TOKEN EXPRESSION)| eps] [VIRGULE_TOKEN| eps] PARENTHESE_F_TOKEN 
    | NOUVEAU_TOKEN IDENTIFIANT_TOKEN LISTE_EXPRESSIONS 
    | IDENTIFIANT_TOKEN [[LISTE_EXPRESSIONS | INVERSER_TOKEN | TAILLE_TOKEN | (CROCHET_O_TOKEN NOMBRE_LITTERAL_TOKEN CROCHET_F_TOKEN) | (SPLIT_TOKEN PARENTHESE_O_TOKEN EXPRESSION PARENTHESE_F_TOKEN ) | DEUXIEME_EXPRESSION_BINAIRE] | eps ]
    | LITTERAL [ [INVERSER_TOKEN | TAILLE_TOKEN | (CROCHET_O_TOKEN NOMBRE_LITTERAL_TOKEN CROCHET_F_TOKEN) | (SPLIT_TOKEN PARENTHESE_O_TOKEN EXPRESSION PARENTHESE_F_TOKEN ) | DEUXIEME_EXPRESSION_BINAIRE] | eps ]
    | (OPERATEUR_NON_TOKEN | OPERATEUR_MOINS_TOKEN) EXPRESSION 
    | CROCHET_O_TOKEN [(EXPRESSION (VIRGULE_TOKEN EXPRESSION)* [VIRGULE_TOKEN | eps])| eps] CROCHET_F_TOKEN 
    | CHAMP_AVANT_IMAGE_TOKEN 

DEUXIEME_EXPRESSION_BINAIRE :  ( OPERATEUR_FOIS_TOKEN | OPERATEUR_DIVISER_TOKEN | OPERATEUR_MODULO_TOKEN | OPERATEUR_PLUS_TOKEN | OPERATEUR_MOINS_TOKEN | OPERATEUR_INF_TOKEN | OPERATEUR_INFEG_TOKEN | OPERATEUR_SUP_TOKEN | OPERATEUR_SUPEG_TOKEN | OPERATEUR_EGAL_TOKEN | OPERATEUR_DIFFERENT_TOKEN | OPERATEUR_BINAIRE_ET_TOKEN | OPERATEUR_BINAIRE_XOR_TOKEN | OPERATEUR_BINAIRE_OU_TOKEN | OPERATEUR_ET_TOKEN | OPERATEUR_OU_TOKEN) (IDENTIFIANT_TOKEN | LITTERAL) 

LITTERAL : BOOLEAN_LITTERAL_TOKEN
    | NOMBRE_LITTERAL
    | STRING_LITTERAL_TOKEN
    | DATE_LITTERAL
    | HEX_LITTERAL_TOKEN;

NOMBRE_LITTERAL : NOMBRE_LITTERAL_TOKEN [UNITE_TOKEN| eps];

NOM_TYPE : TYPE_ENTIER_TOKEN | TYPE_BOOLEAN_TOKEN | TYPE_STRING_TOKEN | TYPE_CLE_PUBLIQUE_TOKEN | TYPE_SIGNATURE_TOKEN | TYPE_SIGNATURE_DONNEE_TOKEN | BYTES;

BYTES : BYTES_TOKEN [[[1-9] [0-9]*] | eps];

DATE_LITTERAL : DATE_TOKEN STRING_LITTERAL_TOKEN PARENTHESE_F_TOKEN;

////////////
WHILE : WHILE_TOKEN PARENTHESE_O_TOKEN EXPRESSION PARENTHESE_F_TOKEN BLOC ;
ECRIRE : ECRIRE_TOKEN PARENTHESE_O_TOKEN EXPRESSION PARENTHESE_F_TOKEN POINT_VIRGULE_TOKEN ;
LIRE : LIRE_TOKEN  IDENTIFIANT_TOKEN PARENTHESE_F_TOKEN POINT_VIRGULE_TOKEN ;
////////////
COMMENT : CO_TOKEN .* CF_TOKEN ;

LINE_COMMENT : COMMENTAIRE_LIGNE_TOKEN ~[\r\n]* ;

VERSION_LITTERALE_TOKEN : NOMBRE_LITTERAL_TOKEN POINT_TOKEN NOMBRE_LITTERAL_TOKEN POINT_TOKEN NOMBRE_LITTERAL_TOKEN ;
BOOLEAN_LITTERAL_TOKEN=TRUE_TOKEN | FALSE_TOKEN
UNITE_TOKEN=SATOSHIS_TOKEN | SATS_TOKEN | FINNEY_TOKEN | BITS_TOKEN | BITCOIN_TOKEN | SECONDS_TOKEN | MINUTES_TOKEN | HOURS_TOKEN | DAYS_TOKEN | WEEKS_TOKEN
STRING_LITTERAL_TOKEN : [ GUILLEMET_SIMPLE_TOKEN STRING_VALEUR_TOKEN GUILLEMET_SIMPLE_TOKEN ] | [ GUILLEMET_TOKEN STRING_VALEUR_TOKEN GUILLEMET_TOKEN ]
TX_VAR_TOKEN=TX_AGE_TOKEN|TX_TIME_TOKEN
CHAMP_AVANT_IMAGE_TOKEN=TX_VERSION_TOKEN| TX_HASHPREVOUTS_TOKEN| TX_HASHSEQUENCE_TOKEN| TX_OUTPOINT_TOKEN| TX_BYTECODE_TOKEN| TX_VALUE_TOKEN| TX_SEQUENCE_TOKEN| TX_HASHOUTPUTS_TOKEN| TX_LOCKTIME_TOKEN| TX_HASHTYPE_TOKEN| TX_PREIMAGE_TOKEN